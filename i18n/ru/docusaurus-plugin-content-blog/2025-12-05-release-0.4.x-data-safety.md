---
slug: release-0-4-x-data-safety
title: "Релиз 0.4.x: безопасное удаление биллинга и воркспейсов"
authors: [negashev]
tags: [gorizond]
---

В релизе 0.3.0 мы предупреждали о риске: удаление Billing или всех Fleet workspaces могло навсегда унести баланс и даже отключить Fleet UI. В линейке 0.4.x эта проблема закрыта — добавлены финалайзеры и перенос баланса при удалении биллинга, а обработка ресурсов Fleet стала аккуратной.

<!-- truncate -->

### Что изменилось
- v0.4.0 — финалайзер Billing блокирует удаление, пока баланс не перенесён; контроллер переводит остаток и консистентно восстанавливает связанные Cluster ресурсы. Это устраняет потерю средств при удалении биллинга.
- v0.4.1 — переработана reconcile-логика FleetBundle: обновляются только нужные объекты без перезаписи или удаления несвязанных ресурсов, чтобы Fleet UI/расширения не пропадали при чистке workspaces.
- v0.4.2 — вынесены версии K3S/Headscale chart в конфигурацию окружения; рекомендуем обновляться до последнего патча 0.4.2.

Полные детали: [v0.4.0](https://github.com/gorizond/gorizond-cluster/releases/tag/v0.4.0), [v0.4.1](https://github.com/gorizond/gorizond-cluster/releases/tag/v0.4.1), [v0.4.2](https://github.com/gorizond/gorizond-cluster/releases/tag/v0.4.2) и общий diff [v0.3.0…v0.4.2](https://github.com/gorizond/gorizond-cluster/compare/v0.3.0...v0.4.2).

### Как обновиться
- В GitOps/Fleet bundle обновите chartVersion `gorizond-cluster-controller` до `0.4.2` (или тег `v0.4.2`).
- Перекатите bundle через Fleet/Helm, дождитесь `BundleDeployment` в состоянии `Ready` и обновления подов контроллера.

### Как проверить
- При попытке удалить Billing с балансом ресурс остаётся в `Terminating`, пока контроллер не перенесёт остаток; баланс не пропадает.
- После удаления тестового Fleet workspace расширение Fleet в Rancher остаётся доступным, остальные workspaces можно продолжать создавать/удалять.
- В логах контроллера нет ошибок reconcile для Billing/FleetBundle; метрики/пробы остаются зелёными.
